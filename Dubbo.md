Dubbo

# 分布式系统中的相关概念

### 大型互联网项目架构目标

互联网项目的特点用户多；流量大，并发高；海量数据；易受攻击；功能繁琐；高性能（提供快速的访问体验）。

衡量网站的性能指标

- 响应时间：指执行一个请求从开始到最后收到响应数据所花费的总体时间。

- 并发数：指系统同时能处理的请求数量。

  - 并发连接数：指的是客户端向服务器发起请求，并建立了TCP连接。每秒钟服务器连接的总TCP数量

  - 请求数：也称为 QPS(Query Per Second) 指每秒多少请求.

  并发用户数：单位时间内有多少用户

- 吞吐量：指单位时间内系统能处理的请求数量。

  - QPS：Query Per Second 每秒查询数。

  - TPS：Transactions Per Second 每秒事务数。

  - 一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。
  - 一个页面的一次访问，只会形成一个TPS；但一次页面请求，可能产生多次对服务器的请求，就会有多个QPS

- 高性能：提供快速的访问体验。

- 高可用：网站服务一直可以正常访问。

- 可伸缩：通过硬件增加/减少，提高/降低处理能力。

- 高可扩展：系统间耦合低，方便的通过新增/移除方式，增加/减少新的功能/模块。

- 安全性：提供网站安全访问和数据加密，安全存储等策略。

- 敏捷性：随需应变，快速响应。

### 集群和分布式

- **集群**：一个业务模块，部署在多台服务器上。
  （很多“人”一起 ，干一样的事）
- **分布式**：一个大的业务系统，拆分为小的业务模块，分别部署在不同的机器上。
  （很多“人”一起，干不一样的事。这些不一样的事，合起来是一件大事）

![集群分布式_图片](https://i-blog.csdnimg.cn/blog_migrate/ae01e1b790d4baaf78303b25bdd00083.png#pic_center)

**集群分布式**的优点：高性能+高可用+可伸缩+高可扩展

### 架构演进

![架构演进图](https://i-blog.csdnimg.cn/blog_migrate/7997267e604c80f61f737d0457d10931.png#pic_center)

**1.单体架构**

- 优点：简单：开发部署都很方便，小型项目首选。
- 缺点：项目启动慢；可靠性差；可伸缩性差；扩展性和可维护性差；性能低。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/ef937175a2e63926c7623428d1f02b28.png#pic_center)

**2.垂直架构**

- 垂直架构是指将单体架构中的多个模块拆分为多个独立的项目。形成多个独立的单体架构。
- 单体架构存在的问题：项目启动慢；可靠性差；可伸缩性差；扩展性和可维护性差；性能低。
- 垂直架构存在的问题：重复功能太多。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/131dd272b611dba1bf693b12a98655e2.png#pic_center)

**3.分布式架构**

- 分布式架构是指在垂直架构的基础上，将公共业务模块抽取出来，作为独立的服务，供其他调用者消费，以实现服务的共享和重用。

- RPC： Remote Procedure Call 远程过程调用。有非常多的协议和技术来都实现了RPC的过程。
- 比如：HTTP REST风格，Java RMI规范、WebService SOAP协议、Hession等等。
- 垂直架构存在的问题：重复功能太多
- 分布式架构存在的问题：服务提供方一旦产生变更，所有消费方都需要变更。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/bd588264451e7db9368e36ca5bf3853f.png#pic_center)

**4.SOA架构**

- SOA（Service-Oriented Architecture/面向服务的架构）

- 是一个组件模型，它将应用程序的不同功能单元（称为服务）进行拆分，并通过这些服务之间定义良好的接口和契约联系起来。

- ESB（Enterparise Servce Bus)企业服务总线，服务中介：主要是提供了一个服务于服务之间的交互。

  ESB包含的功能如：负载均衡，流量控制，加密处理，服务的监控，异常处理，监控告急等等。

- 分布式架构存在的问题：服务提供方一旦产生变更，所有消费方都需要变更。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/20d605ba2d33b108525762d3398bf342.png#pic_center)

**5.微服务架构**

- 微服务架构是在SOA做的升华，微服务架构强调的一个重点是“业务需要彻底的组件化和服务化”，原有的单个业务系统会拆分为多个可以独立开发、设计、运行的小应用。这些小应用之间通过服务完成交互和集成。

- 微服务架构 = 80%的SOA服务架构思想 + 100%的组件化架构思想 + 80%的领域建模思想。
- 特点
  - 服务实现组件化：开发者可以自由选择开发技术。也不需要协调其他团队。
  - 服务之间交互一般使用REST API。
  - 去中心化：每个微服务有自己私有的数据库持久化业务数据
  - 自动化部署：把应用拆分成为一个一个独立的单个服务，方便自动化部署、测试、运维
- 缺点
  - 粒度太细导致服务太多，维护成本高。
  - 分布式系统开发的技术成本高，对团队的挑战大。

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/828df9429c822349f63ae6575c16f27d.png#pic_center)

**Dubbo 是 SOA 时代的产物，SpringCloud 是微服务时代的产物**

# Dubbo概述

### Dubbo简介

- **Apache Dubbo**是一款高性能的**Java RPC**框架。

其前身是阿里巴巴公司开源的一个高性能、轻量级的开源**Java RPC**框架，可以和**Spring**框架无缝集成。

- **什么是RPC？**

RPC全称为remote procedure call，即远程过程调用。比如两台服务器A和B，A服务器上部署一个应用，B服务器上部署一个应用，A服务器上的应用想调用B服务器上的应用提供的方法，由于两个应用不在一个内存空间，不能直接调用，所以需要通过网络来表达调用的语义和传达调用的数据。

需要注意的是RPC并不是一个具体的技术，而是指整个网络远程调用过程。

RPC是一个泛化的概念，严格来说一切远程过程调用手段都属于RPC范畴。各种开发语言都有自己的RPC框架。
Java中的RPC框架比较多，广泛使用的有**RMI、Hessian、Dubbo**等。

- **Dubbo**官网地址：[https://dubbo.apache.org/zh/index.html
  ](https://dubbo.apache.org/zh/index.html)
- **Dubbo**提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。

### Dubbo架构

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/fd05d82d9c05d28dd122a4e127b9bc95.png#pic_center)

**节点角色说明**

| 节点      | 角色名称                               |
| --------- | -------------------------------------- |
| Provider  | 暴露服务的服务提供方                   |
| Consumer  | 调用远程服务的服务消费方               |
| Registry  | 服务注册与发现的注册中心               |
| Monitor   | 统计服务的调用次数和调用时间的监控中心 |
| Container | 服务运行容器                           |

虚线都是异步访问，实线都是同步访问
蓝色虚线:在启动时完成的功能
红色虚线(实线)都是程序运行过程中执行的功能

**调用关系说明**

0.服务容器负责启动，加载，运行服务提供者。

1.服务提供者在启动时，向注册中心注册自己提供的服务。

2.服务消费者在启动时，向注册中心订阅自己所需的服务。

3.注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。

4.服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。

5.服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。

## 服务[注册中心](https://so.csdn.net/so/search?q=注册中心&spm=1001.2101.3001.7020)zookeeper

\

### zookeeper下载安装

docker安装

